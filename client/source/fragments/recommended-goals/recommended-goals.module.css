@property --knob {
  syntax: '<number>';
  initial-value: 0;
  inherits: true;
}

.goalCards {
  /* Reducing the constant will make the cards at the back of the stack darker. */
  --dim-factor: calc(var(--total) * 2);
  /* Reducing the constant will make the cards at the back of the stack smaller. */
  --shrink-factor: calc(var(--total) * 10);
  --goal-card-border-radius: 5dvh;
  --goal-card-height: calc(60dvh - (var(--side-padding) * 0.5));
  --goal-card-border-width: 4px;
  --knob: 0;

  display: grid;
  overflow-x: hidden;
  overflow-y: auto;
  width: 100%;
  height: 100%;
  animation-name: turn-scroll-knob;
  animation-duration: auto;
  scrollbar-width: none;
  overscroll-behavior-y: auto;
  scroll-snap-align: start;

  grid-template-columns: 1fr;
  grid-template-rows: repeat(var(--total), auto);
  grid-row: 1;
  grid-column: 1;
  translate: 0 calc(var(--goal-card-border-radius) * 1.5);
  animation-timeline: scroll(self block);

  &.fallback {
    animation-duration: 100ms;
    animation-play-state: paused;
  }

  & > * {
    --shrink: calc((var(--index) / var(--shrink-factor)));
    --brightness: calc(
      1 - (var(--index) / var(--dim-factor)) + var(--knob) * 0.25
    );
    --animation-duration: calc(var(--default-duration) * 2);
    --animation-delay: calc(var(--default-duration) * var(--index) * 0.25);

    position: sticky;
    z-index: calc(var(--total) - var(--index));
    top: 0;
    margin-block-end: -12dvh;
    transform: perspective(500px) rotateX(calc(var(--knob) * -1.8deg));
    animation: card var(--animation-duration) var(--animation-delay) backwards;
    filter: drop-shadow(0 0 10px #00000080) brightness(var(--brightness));
    translate: 0
      calc((var(--total) - var(--index)) * 7.5dvh + (var(--knob) * 25dvh));
    scale: calc(1 - var(--shrink) + var(--knob) * 0.07);
    grid-column: 1;
    /* Makes the cards appear in reverse order, with the first being last. */
    grid-row: calc(var(--total) - var(--index));

    @supports not (animation-timeline: scroll(self block)) {
      transition-duration: var(--animation-duration);
      transition-property: transform, opacity, filter, translate, scale;
    }
  }
}

@keyframes card {
  from {
    opacity: 0;
    translate: 0 calc((var(--total) - var(--index)) * 10dvh);
  }
}

@keyframes turn-scroll-knob {
  from {
    --knob: 1;
  }
  to {
    --knob: 0;
  }
}

.buttonRow {
  --animation-delay: calc(var(--default-duration) * 3);
  --gap: 10px;
  --starting-fade-position-y: 40%;
  z-index: 1;
  display: grid;
  align-self: end;
  width: calc(90% - var(--side-padding));
  margin-bottom: var(--block-padding);
  opacity: 0;
  animation: var(--fade-in-from-bottom) calc(var(--default-duration) * 1.2)
    var(--animation-delay) both;
  grid-template-columns: auto auto;
  gap: var(--gap);
  justify-self: center;
  grid-row: 1;
  grid-column: 1;
}

.btn {
  filter: drop-shadow(0 0 10px #0000003e);
  place-content: center;
}
